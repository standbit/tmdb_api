# TMDB_API
Упражнение на чтение кода. Фильмы с TMDB.

## Как использовать код проекта?
### Первые шаги
1. Python3 должен быть установлен
2. Склонируйте репозиторий к себе на компьютер
3. Для страховки работайте в виртуальном окружении
4. Не устанавливайте зависимости из `requirements.txt`, где "заморожен" `requests`. В проекте используется стандартная библиотека запросов `urlib.request`
5. Зарегиструйтесь на сайте [TMDB](https://www.themoviedb.org/)
6. Получите уникальный идентификатор для аутентификации на сайте TMBD - __API key__, ознакомьтесь с [документацией](https://developers.themoviedb.org/3/movies/get-movie-details)
7. Создайте файл `"MyFilmDB.json"` в директории проекта. Здесь будет храниться информация, полученная от API

### Предназначение файлов

#### hello_api_TMDB.py
Проверка API key. Запустите файл в консоли:
```python
python3 hello_api_TMDB.py
```
На приглашение ввести свой ключ, введите API key. Если все ок, то в консоли выведется бюджет фильма под номером `movie_number = <число>` из блока `if __name__ == '__main__'`. Если нет, то `Invalid api key`.

![image](https://user-images.githubusercontent.com/77130336/153907436-ff775bb8-4749-4013-ab83-04fa4ececd9a.png)

### tmdb_helpers.py
Функции из этого модуля работают в модулях `hello_api_TMDB.py` и `make_own_db.py`. 
Кратко, что они делают:
- в первой функции формируется адрес страницы запроса и его параметры (обязательный API key и опциональные), возвращается вызов второй функция с этими данными 
- во второй происходит выполнение запроса к API и получение декодированного ответа, производится десериализация json объекта
- третья возвращает API key пользователя, в случае успешного запроса к API TMDB; поднимает исключение в случае HTTPError

### own_db_helpers.py
Единственная функция этого модуля `load_data(path)` считывает json-файл, в котором лежит "БД" с фильмами, и возвращает объекты python. В примере - это файл `"MyFilmDB.json"`. Функция используется в модулях `search_in_db.py` и `find_similar.py`.

### make_own_db.py
Мы подобрались к ключевому модулю. Здесь описана новая функция `load_films`, возвращающая список фильмов. Есть возможность указать, какой метод GET-запроса будет использован. В нашем случае - это __GET__ `/movie/{movie_id}`. В цикле по количеству фильмов, по-умолчанию - это 1000, собирается информация о фильмах с id от 1 до 1000. Также в консоли интерактивно отображается загрузка данных. 

В блоке `if __name__ == '__main__'` указан файл `"./MyFilmDB.json"`, куда, сохраняется десериализованный json. Можно изменить количество фильмов, о которых нужна информация. В видео ниже будет показан процесс работы модуля с `films_amount = 50`
Запустите файл в консоли:
```python
python3 make_own_db.py
```
![api_db_video](https://user-images.githubusercontent.com/77130336/153938875-4f92863e-db12-4682-abf3-60aa1339af4c.gif)

### search_in_db.py
Здесь описана функция, которая ищет фильмы среди скачанных данных и возвращает множество фильмов, в которых встречается введенное пользователем название фильма. В блоке `if __name__ == '__main__'` пользователя просят ввести путь к файлу с информацией о фильмах и интересующий фильм. В консоли будут выведены названия фильмов. Ниже приведен пример работы модуля. 
Запустите файл в консоли:
```python
python3 search_in_db.py
```
![api_search_video](https://user-images.githubusercontent.com/77130336/153941746-3b4c70dc-8464-408f-8118-7a3c871503fa.gif)

#### find_similar.py
Модуль запускается так же, как и два предыдущих. У него самое интересное предназначение - вывод фильмов, которые "похожи" по определенным критериям, на фильм который ввел пользователь. Механика такая: есть функция `get_rating`, которая проходит по списку словарей всех фильмов файла-БД. Формирует рейтинг каждого фильма исходя из условий совпадения параметра фильма-пользователя и параметра фильма из БД. Например, за совпадение жанров сравниваемых фильмов присваивается 500 у.е. Всего 4 параметра с баллами для сравнения, их можно настроить по своему усмотрению. Затем среди полученного списка фильмов с рейтингом отбирается 9 (по-умолчанию) фильмов с самым высоким рейтингом. Эти фильмы набрали наибольшее количество баллов и по этой методике больше остальных похожи на фильм пользователя. 

Как это работает на примере:

![api_similar_video](https://user-images.githubusercontent.com/77130336/153944883-2d4c6a62-087a-43b8-a0c5-17487b655409.gif)

